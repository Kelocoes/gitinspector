<div id="repository_div">

  <div class="box">

    <div style="width: 20px; position: absolute">
      <div id="repository_label" class="git2 visible">
        Repository Map
      </div>
    </div>

    <div id="repository_tmp">
    </div>

    <div id="repository_box"
         style="display: flex; flex-direction: column; align-items: center">

    </div>
    <script>
      var authors = $authors;
      var ownerships = $ownerships;
      var files = Object.keys(ownerships).sort()

      // d3.select("div#repository_tmp").html(JSON.stringify(authors) + "<br/>" +
      //                                      JSON.stringify(ownerships) + "<br/>" +
      //                                      JSON.stringify(files));

      function build_tree(parent_elem, parent_file, visibility) {
          var heads = files.filter((f) => ownerships[f].parent == parent_file);
          var lis = parent_elem.append("ul").selectAll().data(heads)
                               .enter().append("li")
                               .classed("repline", "true")
                               .style("display", visibility)
                               .attr("data", (d) => d);
          lis.append("div");
          lis.each(function(d) { build_tree(d3.select(this), d, "none"); });
      }

      build_tree(d3.select("div#repository_box"), "", "");
      d3.selectAll("li.repline").each(function() {
          var elem = d3.select(this);
          var file = elem.attr("data");
          var div  = elem.select("div");
          if (ownerships[file]["is_dir"] == "true") {
              div.append("button")
                  .text("+").on("click", function () {
                      var bool = (d3.select(this).classed("visible")),
                          vis  = bool ? "none" : "";
                      d3.select(this).classed("visible", !vis);
                      d3.selectAll("li.repline").filter(function () {
                          return ownerships[d3.select(this).attr("data")]["parent"] == file;
                      }).style("display", vis);
              });
          }
          div.append("span").html(file);
      });

      // var gowns = svg.append("g").attr("transform", "translate(" + xsep + ",0)");
      // Object.keys(ownerships).forEach(function (f) {
      //          var x = 0;
      //          ownerships[f].forEach(function (o) {
      //              gowns.append("rect")
      //                  .attr("x", x).attr("y", y(f)-dy/2)
      //                  .attr("height", dy-10).attr("width", o.rows)
      //                  .attr("fill",authors[o.author]);
      //              x += o.rows;
      //          });
      // });

      // Make the div hideable
      make_box_hideable("repository_label", "repository_box", "flex");
    </script>
  </div>
</div>
